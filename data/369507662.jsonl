[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "e9d5ec65a53b1be2f0519b74ac320a7c48f23636..e8256ccd3dd5b8a10a10336e57316f9c64ec46ae", "message": "fixing na error in twoway_n", "diff": "@@ -26,7 +26,7 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     print(paste0(\"working on \", x))\n     \n     # generate segment\n-    if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n+    if (x %in% \"n\"                              ){try(t <- dplyr::bind_rows(t, twoway_n(data=data, x, treat)))}\n     if (x %in% num & !x %in% dates              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=F, test=test, shapiro.p=shapiro.p)))}\n     if (x %in% num & x %in% dates               ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=T, test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cat                              ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}", "原始编码": "GBK", "md5": "7f3665ff087a23f080fe0bdefa3594f9", "时间": "20220125", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_n.R", "文件名": "twoway_n.R", "ext": "R", "index": "e9d5ec65a53b1be2f0519b74ac320a7c48f23636..e8256ccd3dd5b8a10a10336e57316f9c64ec46ae", "message": "fixing na error in twoway_n", "diff": "@@ -6,13 +6,21 @@\n #' \n #' @export\n twoway_n <- function(data, x, group){\n+  \n+  # read data\n   d <- data[!is.na(data[[group]]),]\n-  tab <- table(d[[x]], d[[group]], useNA=\"ifany\")\n+  \n+  # ignore missings\n+  tab <- table(d[[x]], d[[group]])\n   groups <- colnames(tab)\n   if (nrow(tab)>1){stop(\"too many levels for n-count\")}\n+  \n+  # build simple n-table\n   tab <- c(rbind(tab, form.it(prop.table(tab, 2)*100, 1)))\n   tab <- c(x, NA, tab, NA)\n   tab <- as.data.frame(t(tab))\n+  \n+  # wrap up and return\n   colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")\n   return(tab)\n }\n\\ No newline at end of file", "原始编码": "GBK", "md5": "5be0f49a96d8bf2a3d28780e3da29486", "时间": "20220125", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "5a7ac0cc7a00d684fbc2e86d15d5b9dde4f48ea3..e9d5ec65a53b1be2f0519b74ac320a7c48f23636", "message": "added skew.p and initiated skew.sim", "diff": "@@ -9,11 +9,14 @@ export(grab_dst)\n export(is.ok.date)\n export(is.ok.num)\n export(skew.ci)\n+export(skew.p)\n+export(skew.sim)\n export(ttabulate)\n export(twoway_chi)\n export(twoway_n)\n export(twoway_num)\n import(boot)\n+import(foreach)\n import(lubridate)\n import(matrixStats)\n import(ordinal)", "原始编码": "GBK", "md5": "51e38f47beefd9d6002169de3a55465d", "时间": "20211219", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/tgears.R", "文件名": "tgears.R", "ext": "R", "index": "5a7ac0cc7a00d684fbc2e86d15d5b9dde4f48ea3..e9d5ec65a53b1be2f0519b74ac320a7c48f23636", "message": "added skew.p and initiated skew.sim", "diff": "@@ -19,4 +19,92 @@ skew.ci <- function(x, rep=1000, stat=\"median\", alt=\"two.sided\", alpha=.95){\n   \n   return(e)\n } \n-  \n\\ No newline at end of file\n+  \n+#' calculate bootstrapped (non-parametric) ci and p-values for differences between two groups \n+#' \n+#' @param d data that includes outcome and grouping variable\n+#' @param y outcome variable to test differences on\n+#' @param x grouping variable (coded 1 and 0 for reference group)\n+#' @param rep number of bootstrap draws\n+#' @param stat statistic to compare differences on\n+#' @return returns rdf row with a p-value and lower and upper confidence interval limits\n+#' @import foreach  \n+#' \n+#' @export\n+skew.p <- function(data, y, x, rep=1000, stat=\"median\"){\n+  \n+  # resampling of observed difference\n+  diff1 <- foreach (i = 1:rep, .combine='c') %do% {\n+    d0 <- sample(data[[y]][data[[x]]==0], sum(data[[x]]==0), replace=T)\n+    d1 <- sample(data[[y]][data[[x]]==1], sum(data[[x]]==1), replace=T)\n+    get(stat)(d1)-get(stat)(d0)\n+  }\n+  \n+  # get non-parametric CIs of difference\n+  ci <- quantile(diff1, c(.025, .975))\n+  \n+  # implicit two-sided test of difference, including correction\n+  p <- (sum(diff1>=0)+1)/(rep+1)\n+  \n+  # correct reverse falses\n+  if (get(stat)(diff1)<0){\n+    p <- abs(p)\n+  } else {\n+    p <- 1-p\n+  }\n+  \n+  # return as rdf row, convert p to 2-sided\n+  return(data.frame(p=p*2, ci_lo=ci[1], ci_hi=ci[2]))\n+} \n+\n+#' simulate / experiment with bootstrapping (non-parametric) of differences between two groups \n+#' \n+#' @param d data that includes outcome and grouping variable\n+#' @param y outcome variable to test differences on\n+#' @param x grouping variable (coded 1 and 0 for reference group)\n+#' @param rep number of bootstrap draws\n+#' @param stat statistic to compare differences on\n+#' @return returns rdf row with a p-value and lower and upper confidence interval limits\n+#' @import foreach  \n+#' \n+#' @export\n+skew.sim <- function(data, y, x, rep=1000, stat=\"median\"){\n+  \n+  # null difference\n+  diff0 <- foreach (i = 1:rep, .combine='c') %do% {\n+    d0 <- sample(data[[y]], sum(data[[x]]==0), replace=T)\n+    d1 <- sample(data[[y]], sum(data[[x]]==1), replace=T)\n+    get(stat)(d1)-get(stat)(d0)\n+  }\n+  \n+  # resampling of observed difference\n+  diff1 <- foreach (i = 1:rep, .combine='c') %do% {\n+    d0 <- sample(data[[y]][data[[x]]==0], sum(data[[x]]==0), replace=T)\n+    d1 <- sample(data[[y]][data[[x]]==1], sum(data[[x]]==1), replace=T)\n+    get(stat)(d1)-get(stat)(d0)\n+  }\n+  \n+  # get CIs of difference\n+  ci <- quantile(diff1, c(.025, .975))\n+  \n+  # implicit two-sided test of difference\n+  p  <- (sum(abs(diff0)>=abs(get(stat)(data[[y]][data[[x]]==1])-get(stat)(data[[y]][data[[x]]==0])))+1)/(rep+1)\n+  \n+  # other approach, one sided-test\n+  p1 <- (sum(diff1>=0)+1)/(rep+1)\n+  \n+  # references, relevant for\n+  w <- wilcox.test(y~treat, data=data)$p.value\n+  t <- t.test(y~treat, data=data)$p.value\n+  t1 <- t.test(y~treat, data=data, alternative=\"less\")$p.value # one-sided t-test as reference\n+  \n+  # correct reverse falses\n+  if (get(stat)(diff1)<0){\n+    p1 <- abs(p1)\n+  } else {\n+    p1 <- 1-p1\n+  }  \n+  \n+  # return as rdf row \n+  return(data.frame(p=p, p1=p1*2, ci_lo=ci[1], ci_hi=ci[2], w=w, t=t, t1=t1))\n+} ", "原始编码": "GBK", "md5": "d9b0857f8deacf8895655ee4ae1408c3", "时间": "20211219", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/skew.p.Rd", "文件名": "skew.p.Rd", "ext": "Rd", "index": "5a7ac0cc7a00d684fbc2e86d15d5b9dde4f48ea3..e9d5ec65a53b1be2f0519b74ac320a7c48f23636", "message": "added skew.p and initiated skew.sim", "diff": "@@ -0,0 +1,25 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/tgears.R\n+\\name{skew.p}\n+\\alias{skew.p}\n+\\title{calculate bootstrapped (non-parametric) ci and p-values for differences between two groups}\n+\\usage{\n+skew.p(data, y, x, rep = 1000, stat = \"median\")\n+}\n+\\arguments{\n+\\item{y}{outcome variable to test differences on}\n+\n+\\item{x}{grouping variable (coded 1 and 0 for reference group)}\n+\n+\\item{rep}{number of bootstrap draws}\n+\n+\\item{stat}{statistic to compare differences on}\n+\n+\\item{d}{data that includes outcome and grouping variable}\n+}\n+\\value{\n+returns rdf row with a p-value and lower and upper confidence interval limits\n+}\n+\\description{\n+calculate bootstrapped (non-parametric) ci and p-values for differences between two groups\n+}", "原始编码": "GBK", "md5": "52b93f58de77e47f620fb0b47a6e5315", "时间": "20211219", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/skew.sim.Rd", "文件名": "skew.sim.Rd", "ext": "Rd", "index": "5a7ac0cc7a00d684fbc2e86d15d5b9dde4f48ea3..e9d5ec65a53b1be2f0519b74ac320a7c48f23636", "message": "added skew.p and initiated skew.sim", "diff": "@@ -0,0 +1,25 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/tgears.R\n+\\name{skew.sim}\n+\\alias{skew.sim}\n+\\title{simulate / experiment with bootstrapping (non-parametric) of differences between two groups}\n+\\usage{\n+skew.sim(data, y, x, rep = 1000, stat = \"median\")\n+}\n+\\arguments{\n+\\item{y}{outcome variable to test differences on}\n+\n+\\item{x}{grouping variable (coded 1 and 0 for reference group)}\n+\n+\\item{rep}{number of bootstrap draws}\n+\n+\\item{stat}{statistic to compare differences on}\n+\n+\\item{d}{data that includes outcome and grouping variable}\n+}\n+\\value{\n+returns rdf row with a p-value and lower and upper confidence interval limits\n+}\n+\\description{\n+simulate / experiment with bootstrapping (non-parametric) of differences between two groups\n+}", "原始编码": "GBK", "md5": "b00874df7556fadeade729f26bcede77", "时间": "20211219", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_chi.R", "文件名": "twoway_chi.R", "ext": "R", "index": "d3e316dcf5d41e9f1d6a2d8555e81dc5d20792e7..5a7ac0cc7a00d684fbc2e86d15d5b9dde4f48ea3", "message": "show.na mod", "diff": "@@ -20,7 +20,7 @@ twoway_chi <- function(data, x, group, bin=F, cens, force.two=F, show.na=F) {\n   if (is.null(cens)){cens <- -Inf}\n   \n   # generate table, p.value and labels\n-  tab <- table(as.character(d[[x]]), d[[group]], useNA=\"ifany\")\n+  tab <- table(as.character(d[[x]]), d[[group]], useNA=ifelse(show.na, \"ifany\", \"no\"))\n   \n   groups <- colnames(tab)\n   if (nrow(tab)<2){stop(\"too few levels\")}", "原始编码": "GBK", "md5": "db21724067307d1f8226b2e6931e16d9", "时间": "20211213", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "05515830b2992dc1f55f94afd569dddc8e2d7884..d3e316dcf5d41e9f1d6a2d8555e81dc5d20792e7", "message": "adding skew.ci boot function", "diff": "@@ -8,10 +8,12 @@ export(get.q)\n export(grab_dst)\n export(is.ok.date)\n export(is.ok.num)\n+export(skew.ci)\n export(ttabulate)\n export(twoway_chi)\n export(twoway_n)\n export(twoway_num)\n+import(boot)\n import(lubridate)\n import(matrixStats)\n import(ordinal)", "原始编码": "GBK", "md5": "b6cdab0fb1b09adae0b4b696e8f56b5a", "时间": "20210916", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/skew.ci.Rd", "文件名": "skew.ci.Rd", "ext": "Rd", "index": "05515830b2992dc1f55f94afd569dddc8e2d7884..d3e316dcf5d41e9f1d6a2d8555e81dc5d20792e7", "message": "adding skew.ci boot function", "diff": "@@ -0,0 +1,25 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/tgears.R\n+\\name{skew.ci}\n+\\alias{skew.ci}\n+\\title{calculate ci for skewed distribution point estimates}\n+\\usage{\n+skew.ci(x, rep = 1000, stat = \"median\", alt = \"two.sided\", alpha = 0.95)\n+}\n+\\arguments{\n+\\item{x}{variable to derive ci from}\n+\n+\\item{rep}{number of bootstrap draws}\n+\n+\\item{stat}{point estimate statistic to calculate ci for}\n+\n+\\item{alt}{one or two-sided testing}\n+\n+\\item{alpha}{alpha level}\n+}\n+\\value{\n+returns a vector of length 2 with lower and upper interval limits\n+}\n+\\description{\n+calculate ci for skewed distribution point estimates\n+}", "原始编码": "GBK", "md5": "0bfc947cd27ddd0d269639516b3d5fa8", "时间": "20210916", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/tgears.R", "文件名": "tgears.R", "ext": "R", "index": "621130ccf35f8f1bd64a21ff5b172b03941074c8..05515830b2992dc1f55f94afd569dddc8e2d7884", "message": "adding skew.ci boot function", "diff": "@@ -0,0 +1,22 @@\n+\n+#' calculate ci for skewed distribution point estimates\n+#' \n+#' @param x variable to derive ci from\n+#' @param rep number of bootstrap draws\n+#' @param stat point estimate statistic to calculate ci for\n+#' @param alt one or two-sided testing\n+#' @param alpha alpha level\n+#' @return returns a vector of length 2 with lower and upper interval limits\n+#' @import boot  \n+#' \n+#' @export\n+skew.ci <- function(x, rep=1000, stat=\"median\", alt=\"two.sided\", alpha=.95){\n+  \n+  if (stat==\"median\"){\n+    e <- boot::boot(data = x, statistic = function(x,i) median(x[i]), R = rep)\n+    e <- boot::boot.ci(e, type=\"perc\")$percent[4:5] \n+  } \n+  \n+  return(e)\n+} \n+  \n\\ No newline at end of file", "原始编码": "GBK", "md5": "f2b839e31b1c4600aa720a6a86dd26f0", "时间": "20210916", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "64403b090d90adb3827fc9b1cd48a0359a0df0a3..621130ccf35f8f1bd64a21ff5b172b03941074c8", "message": "merging features from old ttools", "diff": "@@ -14,6 +14,7 @@ export(twoway_n)\n export(twoway_num)\n import(lubridate)\n import(matrixStats)\n+import(ordinal)\n importFrom(foreach,\"%do%\")\n importFrom(magrittr,\"%>%\")\n importFrom(stats,as.formula)", "原始编码": "GBK", "md5": "2d1307f6b6d27045efe7c716d8c90f0c", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "2ace911e849ed66de6fb9ac9114f4238e1a0be7b..64403b090d90adb3827fc9b1cd48a0359a0df0a3", "message": "merging features from old ttools", "diff": "@@ -8,6 +8,7 @@\n #' @param cal.date logical indicating that the x variable should be treated as a date. Will then show the mean value as an actual date.\n #' @import matrixStats \n #' @import lubridate  \n+#' @import ordinal  \n #' \n #' @export \n twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F, test=\"auto\", shapiro.p=.0001){\n@@ -52,7 +53,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   # adding inferential test\n   if (test==\"rank\"){\n     tab[length(tab)+1] <- tryCatch({form.it(\n-      ordinal:::anova.clm(ordinal::clm(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\"), weights = data[[\"weight\"]], data=data, link = \"logit\"))$`Pr(>Chisq)`, 3)}, error=function(err) NA)\n+      ordinal:::anova.clm(ordinal::clm(paste0(\"as.factor(as.num(\", x, \"))~as.factor(\", group, \")\"), weights = data[[\"weight\"]], data=data, link = \"logit\"))$`Pr(>Chisq)`, 3)}, error=function(err) NA)\n   } else if (test==\"ttest\"){\n     yy <- as.num(data[,x])\n     xx <- data[,group]", "原始编码": "GBK", "md5": "b4875e6a5f38ed4f64d316695d127632", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "22aff11ad3e7da499b1fa9d2efb43d9f2b3a4bc5..2ace911e849ed66de6fb9ac9114f4238e1a0be7b", "message": "merging features from old ttools", "diff": "@@ -34,8 +34,8 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n       tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n-      #tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-      #tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n     # move on for next group", "原始编码": "GBK", "md5": "1b38ebef4c4e27d634171b97f044b2e1", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "9f07f43eb2d8c525dc8a21bcddb10cab47da9ad9..22aff11ad3e7da499b1fa9d2efb43d9f2b3a4bc5", "message": "merging features from old ttools", "diff": "@@ -27,7 +27,8 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num                              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=ifelse(x %in% dates, T, F), test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% num & !x %in% dates              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=F, test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% num & x %in% dates               ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=T, test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cat                              ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin        ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}", "原始编码": "GBK", "md5": "2bff27ef88c2a81faf54981ff9023626", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "a1e506ca41eb546ac73bd681af9b3525dc07dbdb..9f07f43eb2d8c525dc8a21bcddb10cab47da9ad9", "message": "merging features from old ttools", "diff": "@@ -27,7 +27,7 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num                              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=(x %in% dates), test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% num                              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=ifelse(x %in% dates, T, F), test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cat                              ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin        ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}", "原始编码": "GBK", "md5": "0c5f6719c858c1cd81eb599eb304c50f", "时间": "20210915", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "a1e506ca41eb546ac73bd681af9b3525dc07dbdb..9f07f43eb2d8c525dc8a21bcddb10cab47da9ad9", "message": "merging features from old ttools", "diff": "@@ -26,16 +26,14 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   # get mean and SD \n   k <- 3\n   for (i in 1:length(groups)){\n-    print(cal.date)\n+\n     # add mean, SD and median (in date format if x is Date)\n     if (cal.date==F){\n       tab[k+0] <- form.it(matrixStats::weightedMean  (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.m)\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n-      print(tab)\n       tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n-      print(tab)\n       #tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       #tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }", "原始编码": "GBK", "md5": "d04bc0f7c5d01db92f3a736bf4c311eb", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "9db7801c787005baa73425d2908e477c8cf85300..a1e506ca41eb546ac73bd681af9b3525dc07dbdb", "message": "merging features from old ttools", "diff": "@@ -26,7 +26,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   # get mean and SD \n   k <- 3\n   for (i in 1:length(groups)){\n-    \n+    print(cal.date)\n     # add mean, SD and median (in date format if x is Date)\n     if (cal.date==F){\n       tab[k+0] <- form.it(matrixStats::weightedMean  (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.m)", "原始编码": "GBK", "md5": "4ee522e8f24a647623fcdbc86312a7f4", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "e285c52afab978a84caa29d28f2f614de8c5d591..9db7801c787005baa73425d2908e477c8cf85300", "message": "merging features from old ttools", "diff": "@@ -33,6 +33,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n+      print(tab)\n       tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n       print(tab)\n       #tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)", "原始编码": "GBK", "md5": "0730250bdf51a3479238e456775b10fa", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "e38d8cfb29c5692b4e7e4599d2d423cec1221955..e285c52afab978a84caa29d28f2f614de8c5d591", "message": "merging features from old ttools", "diff": "@@ -34,6 +34,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n       tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      print(tab)\n       #tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       #tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }", "原始编码": "GBK", "md5": "a2f2aa0808b017402b1cf6148320e56b", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "26eda0bc25ec4d6c3b110aabd36d85970f9d3ba3..e38d8cfb29c5692b4e7e4599d2d423cec1221955", "message": "merging features from old ttools", "diff": "@@ -12,6 +12,8 @@ export(ttabulate)\n export(twoway_chi)\n export(twoway_n)\n export(twoway_num)\n+import(lubridate)\n+import(matrixStats)\n importFrom(foreach,\"%do%\")\n importFrom(magrittr,\"%>%\")\n importFrom(stats,as.formula)", "原始编码": "GBK", "md5": "0ef167fb7bc4fc67810a836d75952c04", "时间": "20210915", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "26eda0bc25ec4d6c3b110aabd36d85970f9d3ba3..e38d8cfb29c5692b4e7e4599d2d423cec1221955", "message": "merging features from old ttools", "diff": "@@ -33,9 +33,9 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n-      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n-      tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      #tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+      #tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n     # move on for next group", "原始编码": "GBK", "md5": "15d8428d5c3b363db20762c14150c903", "时间": "20210915", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/ttabulate.Rd", "文件名": "ttabulate.Rd", "ext": "Rd", "index": "26eda0bc25ec4d6c3b110aabd36d85970f9d3ba3..e38d8cfb29c5692b4e7e4599d2d423cec1221955", "message": "merging features from old ttools", "diff": "@@ -8,13 +8,17 @@ ttabulate(\n   data,\n   xs,\n   treat,\n+  weight = NULL,\n   num = NA,\n   cat = NA,\n   bin = NA,\n   dichotomize = NA,\n-  cal.date = NA,\n+  dates = NA,\n   cens = 5,\n-  show.na = F\n+  show.na = F,\n+  na.count = F,\n+  test = \"auto\",\n+  shapiro.p = 1e-04\n )\n }\n \\arguments{", "原始编码": "GBK", "md5": "19c2fb2828eab359806615a79cf45a8d", "时间": "20210915", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/twoway_num.Rd", "文件名": "twoway_num.Rd", "ext": "Rd", "index": "26eda0bc25ec4d6c3b110aabd36d85970f9d3ba3..e38d8cfb29c5692b4e7e4599d2d423cec1221955", "message": "merging features from old ttools", "diff": "@@ -4,7 +4,17 @@\n \\alias{twoway_num}\n \\title{twoway table of numeric data}\n \\usage{\n-twoway_num(data, x, group, digit.m = 1, digit.sd = 1, cal.date = F)\n+twoway_num(\n+  data,\n+  x,\n+  group,\n+  weight,\n+  digit.m = 1,\n+  digit.sd = 1,\n+  cal.date = F,\n+  test = \"auto\",\n+  shapiro.p = 1e-04\n+)\n }\n \\arguments{\n \\item{data}{data frame}", "原始编码": "GBK", "md5": "2ad95eefab27f4ebc420148825b04df3", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "338eb2044f426067a5ede9fdea6290887b84a1ec..26eda0bc25ec4d6c3b110aabd36d85970f9d3ba3", "message": "merging features from old ttools", "diff": "@@ -33,9 +33,9 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n-      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(as.chr(data[[x]][data[[group]]==groups[i]])), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n-      tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.chr(data[[x]][data[[group]]==groups[i]])), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.chr(data[[x]][data[[group]]==groups[i]])), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.Date(as.chr(data[[x]][data[[group]]==groups[i]]))), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n     # move on for next group", "原始编码": "GBK", "md5": "c6db043b2b038d2498a4166fae6a30ad", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "728242cb47f55c268264ef26d37dced0f3dbad9b..338eb2044f426067a5ede9fdea6290887b84a1ec", "message": "merging features from old ttools", "diff": "@@ -33,9 +33,9 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n-      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n-      tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(as.chr(data[[x]][data[[group]]==groups[i]])), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+1] <- form.it(matrixStats::weightedSd    (as.num(as.chr(data[[x]][data[[group]]==groups[i]])), w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(as.chr(data[[x]][data[[group]]==groups[i]])), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n     # move on for next group", "原始编码": "GBK", "md5": "b823e0367c568420d1b4da26c3d9d6d9", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "00326364e321e0a17a99315a335b1afbf61ad56c..728242cb47f55c268264ef26d37dced0f3dbad9b", "message": "merging features from old ttools", "diff": "@@ -33,15 +33,15 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n       tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n-      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean  (as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n       tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-      tab[k+2] <- form.it(lubridate::as_date(round(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+2] <- as.chr(lubridate::as_date(round(matrixStats::weightedMedian(as.num(data[[x]][data[[group]]==groups[i]]), w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n     # move on for next group\n     k <- k+3\n   }\n-  print(tab)\n+\n   # decide which test to use\n   if (test==\"auto\"){\n     if(shapiro.test(resid(glm(paste0(\"as.num(\", x, \")~factor(\", group, \")\"), data=data)))$p.value<shapiro.p){", "原始编码": "GBK", "md5": "06706b496d9b5dd4b390f9f087463f3e", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "cc88e72a0859a9aaa5610f6099ad004cb3795f3a..00326364e321e0a17a99315a335b1afbf61ad56c", "message": "merging features from old ttools", "diff": "@@ -38,11 +38,10 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n       tab[k+2] <- form.it(lubridate::as_date(round(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n-\n     # move on for next group\n     k <- k+3\n   }\n-  \n+  print(tab)\n   # decide which test to use\n   if (test==\"auto\"){\n     if(shapiro.test(resid(glm(paste0(\"as.num(\", x, \")~factor(\", group, \")\"), data=data)))$p.value<shapiro.p){", "原始编码": "GBK", "md5": "3c294f230fd803019d9d3870c0c42dcc", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "d3a2108544629849bfbc1b10eaa2a9e6c877325b..cc88e72a0859a9aaa5610f6099ad004cb3795f3a", "message": "merging features from old ttools", "diff": "@@ -27,7 +27,7 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num                              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date==(x %in% dates), test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% num                              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date=(x %in% dates), test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cat                              ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin        ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}", "原始编码": "GBK", "md5": "1105fe1c882c052486d6c777e1fc36c1", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "a4a5163c39b17a6582b304b4d259289bc861e35f..d3a2108544629849bfbc1b10eaa2a9e6c877325b", "message": "merging features from old ttools", "diff": "@@ -19,16 +19,15 @@\n #' @importFrom stats wilcox.test\n #' \n #' @export\n-ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F, na.count=F, test=\"auto\", shapiro.p=0.0001){\n+ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dichotomize=NA, dates=NA, cens=5, show.na=F, na.count=F, test=\"auto\", shapiro.p=0.0001){\n   data <- as.rdf(data)\n   t <- data.frame()\n   for (x in xs){\n     print(paste0(\"working on \", x))\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num & !x %in% cal.date           ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date==F, test=test, shapiro.p=shapiro.p)))}\n-    if (x %in% cal.date                         ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date==T, test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% num                              ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date==(x %in% dates), test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cat                              ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin        ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}", "原始编码": "GBK", "md5": "8a87305d69c33460e66be6dcdfd5dbfd", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "4eefdb1d99caf227a17fd53e439fd2ea0740b458..a4a5163c39b17a6582b304b4d259289bc861e35f", "message": "merging features from old ttools", "diff": "@@ -27,17 +27,18 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   k <- 3\n   for (i in 1:length(groups)){\n     \n-    # add mean (in date format if x is Date)\n+    # add mean, SD and median (in date format if x is Date)\n     if (cal.date==F){\n       tab[k+0] <- form.it(matrixStats::weightedMean  (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.m)\n+      tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+      tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n     } else {\n-      tab[k+0] <- as.character(lubridate::as_date(round(matrixStats::weightedMean(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+0] <- as.chr(lubridate::as_date(round(matrixStats::weightedMean(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n+      tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+      tab[k+2] <- form.it(lubridate::as_date(round(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n     \n-    # add SD and median\n-    tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-    tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n-    \n+\n     # move on for next group\n     k <- k+3\n   }", "原始编码": "GBK", "md5": "c206b24e2ee74179f374e3c807a9e069", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "517bf87d260e02888b72d4fe079e7ccae0fa48dd..4eefdb1d99caf227a17fd53e439fd2ea0740b458", "message": "merging features from old ttools", "diff": "@@ -53,7 +53,7 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n   } \n   \n   # align formatting\n-  t <- t %>% dplyr::mutate_if(.predicate = is.ok.num & !is.ok.date, function(x) as.num(as.chr(x)))\n+  t <- t %>% dplyr::mutate_if(.predicate = is.ok.num, function(x) as.num(as.chr(x)))\n   t <- t %>% dplyr::mutate_if(.predicate = is.factor, function(x)       (as.chr(x)))\n   return(t)\n }", "原始编码": "GBK", "md5": "8b3701f62b8f2500a0587e29c2ac41bb", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "469a6f2f6626b52eba923b601c200e25baf28a60..517bf87d260e02888b72d4fe079e7ccae0fa48dd", "message": "merging features from old ttools", "diff": "@@ -51,7 +51,9 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     t <- cbind(t[,colnames(t)!=\"nas\"], t$nas)\n     colnames(t)[colnames(t) %in% c(\"nas\", \"t$nas\")] <- paste0(\"NA's for \", paste0(groups, collapse=\"/\")) \n   } \n-  t <- t %>% dplyr::mutate_if(.predicate = is.ok.num, function(x) as.num(as.chr(x)))\n+  \n+  # align formatting\n+  t <- t %>% dplyr::mutate_if(.predicate = is.ok.num & !is.ok.date, function(x) as.num(as.chr(x)))\n   t <- t %>% dplyr::mutate_if(.predicate = is.factor, function(x)       (as.chr(x)))\n   return(t)\n }", "原始编码": "GBK", "md5": "ba4fb605e1326af90c022e69f2c74fc0", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "f315eff6c21dbb4a4d2b3919fdd916cd11a423d4..469a6f2f6626b52eba923b601c200e25baf28a60", "message": "merging features from old ttools", "diff": "@@ -7,6 +7,7 @@\n #' @param digit.sd number of digits for estimates of the standard deviation\n #' @param cal.date logical indicating that the x variable should be treated as a date. Will then show the mean value as an actual date.\n #' @import matrixStats \n+#' @import lubridate  \n #' \n #' @export \n twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F, test=\"auto\", shapiro.p=.0001){", "原始编码": "GBK", "md5": "161fc6d6bb5f2b794a881892c7104d92", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "5c0f87a55658b141b4c11a79d9f6a5b64eea69d2..f315eff6c21dbb4a4d2b3919fdd916cd11a423d4", "message": "merging features from old ttools", "diff": "@@ -43,7 +43,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   \n   # decide which test to use\n   if (test==\"auto\"){\n-    if(shapiro.test(resid(glm(paste0(x, \"~factor(\", group, \")\"), data=data)))$p.value<shapiro.p){\n+    if(shapiro.test(resid(glm(paste0(\"as.num(\", x, \")~factor(\", group, \")\"), data=data)))$p.value<shapiro.p){\n       test <- \"rank\"\n     } else {test <- \"ttest\"}\n   }\n@@ -53,7 +53,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n     tab[length(tab)+1] <- tryCatch({form.it(\n       ordinal:::anova.clm(ordinal::clm(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\"), weights = data[[\"weight\"]], data=data, link = \"logit\"))$`Pr(>Chisq)`, 3)}, error=function(err) NA)\n   } else if (test==\"ttest\"){\n-    yy <- data[,x]\n+    yy <- as.num(data[,x])\n     xx <- data[,group]\n     weights <- data[,weight]\n     m <- glm(yy ~ xx, weights = weights)\n@@ -62,7 +62,7 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   \n   # wrap up\n   tab <- as.data.frame(t(tab))\n-  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\"), paste0(groups, \".median\")), \"p\")\n+  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\"), paste0(groups, \".median\")), \"p.val\")\n   tab$test <- test\n   return(tab)\n }", "原始编码": "GBK", "md5": "36bb4f4262181afd301e0fa811866cc7", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "8664a241785248ae5f1bbb2494cd30da8de5f950..5c0f87a55658b141b4c11a79d9f6a5b64eea69d2", "message": "merging features from old ttools", "diff": "@@ -19,7 +19,7 @@\n #' @importFrom stats wilcox.test\n #' \n #' @export\n-ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F, na.count=F, test=NULL, shapiro.p=NULL){\n+ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F, na.count=F, test=\"auto\", shapiro.p=0.0001){\n   data <- as.rdf(data)\n   t <- data.frame()\n   for (x in xs){", "原始编码": "GBK", "md5": "e44f7568c73f8a8403eefe13ae7f75d5", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "662566afb976399699a7cc3b54c101cbb1377b2e..8664a241785248ae5f1bbb2494cd30da8de5f950", "message": "merging features from old ttools", "diff": "@@ -27,10 +27,10 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num & !x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, test=test, shapiro.p=shapiro.p)))}\n-    if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n-    if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n-    if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n+    if (x %in% num & !x %in% cal.date           ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date==F, test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% cal.date                         ){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, cal.date==T, test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% cat                              ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n+    if (x %in% dichotomize & !x %in% bin        ){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n     ", "原始编码": "GBK", "md5": "efe691228bd2465648bd7fc51739958f", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "63ccc2e329eca6b0cc6f20133ff9fe9610c53189..662566afb976399699a7cc3b54c101cbb1377b2e", "message": "merging features from old ttools", "diff": "@@ -27,7 +27,7 @@ ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dich\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, test=test, shapiro.p=shapiro.p)))}\n+    if (x %in% num & !x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n     if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}", "原始编码": "GBK", "md5": "cfcba2b29168e872d1c0b4a8d699d32a", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "171289372a25e6bf2c43ee5045d6be1dd95a1a0b..63ccc2e329eca6b0cc6f20133ff9fe9610c53189", "message": "merging features from old ttools", "diff": "@@ -13,9 +13,9 @@ twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F\n   \n   # ensure rdf object, add/identify weight\n   if (is.null(weight)){data$weight <- 1; weight <- \"weight\"} else {data$weight <- data[[weight]]; data[[weight]] <- NULL; weight <- \"weight\"}\n-  d <- as.rdf(data)[!is.na(data[[group]]),]; rm(\"data\")\n+  data <- as.rdf(data)[!is.na(data[[group]]),] \n   \n-  groups <- unique(na.omit(d[[group]]))\n+  groups <- unique(na.omit(data[[group]]))\n   \n   # placeholder for groups\n   tab <- rep(NA, 2*length(groups)+2)", "原始编码": "GBK", "md5": "df9d9a4ae16653f4f0b18171fbaca2d1", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "99909f502d2ba1094db070170fb0115a880e3aaa..171289372a25e6bf2c43ee5045d6be1dd95a1a0b", "message": "merging features from old ttools", "diff": "@@ -19,15 +19,15 @@\n #' @importFrom stats wilcox.test\n #' \n #' @export\n-ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F, na.count=F){\n+ttabulate <- function(data, xs, treat, weight=NULL, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F, na.count=F, test=NULL, shapiro.p=NULL){\n   data <- as.rdf(data)\n   t <- data.frame()\n   for (x in xs){\n     print(paste0(\"working on \", x))\n     \n     # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n-    if (x %in% num){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2)))}\n+    if (x %in% num){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, weight=weight, digit.m = 2, digit.sd = 2, test=test, shapiro.p=shapiro.p)))}\n     if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n     if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}", "原始编码": "GBK", "md5": "b5ee7261eb153df9badbd231fcd437d5", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "be16e450af1f7f64b17442193cbac53f2a9f7e17..99909f502d2ba1094db070170fb0115a880e3aaa", "message": "merging features from old ttools", "diff": "@@ -6,10 +6,15 @@\n #' @param digit.m number of digits on mean estimates\n #' @param digit.sd number of digits for estimates of the standard deviation\n #' @param cal.date logical indicating that the x variable should be treated as a date. Will then show the mean value as an actual date.\n+#' @import matrixStats \n #' \n #' @export \n-twoway_num <- function(data, x, group, digit.m=1, digit.sd=1, cal.date=F){\n-  d <- data[!is.na(data[[group]]),]\n+twoway_num <- function(data, x, group, weight, digit.m=1, digit.sd=1, cal.date=F, test=\"auto\", shapiro.p=.0001){\n+  \n+  # ensure rdf object, add/identify weight\n+  if (is.null(weight)){data$weight <- 1; weight <- \"weight\"} else {data$weight <- data[[weight]]; data[[weight]] <- NULL; weight <- \"weight\"}\n+  d <- as.rdf(data)[!is.na(data[[group]]),]; rm(\"data\")\n+  \n   groups <- unique(na.omit(d[[group]]))\n   \n   # placeholder for groups\n@@ -20,21 +25,44 @@ twoway_num <- function(data, x, group, digit.m=1, digit.sd=1, cal.date=F){\n   # get mean and SD \n   k <- 3\n   for (i in 1:length(groups)){\n-    if (cal.date==F){tab[k+0] <- form.it(mean(d[[x]][d[[group]]==groups[i]], na.rm=T), digit.m)\n+    \n+    # add mean (in date format if x is Date)\n+    if (cal.date==F){\n+      tab[k+0] <- form.it(matrixStats::weightedMean  (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.m)\n     } else {\n-      tab[k+0] <- as.character(lubridate::as_date(round(mean(d[[x]][d[[group]]==groups[i]], na.rm=T))))\n+      tab[k+0] <- as.character(lubridate::as_date(round(matrixStats::weightedMean(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T))))\n     }\n-    tab[k+1] <- form.it(  sd(d[[x]][d[[group]]==groups[i]], na.rm=T), digit.sd)\n-    k <- k+2\n+    \n+    # add SD and median\n+    tab[k+1] <- form.it(matrixStats::weightedSd    (data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+    tab[k+2] <- form.it(matrixStats::weightedMedian(data[[x]][data[[group]]==groups[i]], w=data$weight[data[[group]]==groups[i]], na.rm=T), digit.sd)\n+    \n+    # move on for next group\n+    k <- k+3\n+  }\n+  \n+  # decide which test to use\n+  if (test==\"auto\"){\n+    if(shapiro.test(resid(glm(paste0(x, \"~factor(\", group, \")\"), data=data)))$p.value<shapiro.p){\n+      test <- \"rank\"\n+    } else {test <- \"ttest\"}\n   }\n   \n   # adding inferential test\n-  if (length(groups)>2){\n-    tab[length(tab)+1] <- tryCatch({form.it(pnorm(abs(coef(summary(MASS::polr(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\"), data=d)))[1,3]), lower.tail = F)*2, 3)}, error=function(err) NA)\n-  } else {\n-    tab[length(tab)+1] <- tryCatch({form.it(wilcox.test(as.formula(paste0(\"as.numeric(\", x, \")~as.factor(\", group, \")\")), data=na.omit(d[,c(x, group)]))$p.value, 3)}, error=function(err) NA)\n+  if (test==\"rank\"){\n+    tab[length(tab)+1] <- tryCatch({form.it(\n+      ordinal:::anova.clm(ordinal::clm(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\"), weights = data[[\"weight\"]], data=data, link = \"logit\"))$`Pr(>Chisq)`, 3)}, error=function(err) NA)\n+  } else if (test==\"ttest\"){\n+    yy <- data[,x]\n+    xx <- data[,group]\n+    weights <- data[,weight]\n+    m <- glm(yy ~ xx, weights = weights)\n+    tab[length(tab)+1] <- tryCatch({form.it(as.numeric(na.omit(lmtest::lrtest(m)$`Pr(>Chisq)`)), 3)}, error=function(err) NA)\n   }\n+  \n+  # wrap up\n   tab <- as.data.frame(t(tab))\n-  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")\n+  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\"), paste0(groups, \".median\")), \"p\")\n+  tab$test <- test\n   return(tab)\n }", "原始编码": "GBK", "md5": "1db29ddb7c2b5c6924a85e1b218819ba", "时间": "20210915", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "553b3e473dd254fc72f6107df5596495866245de..be16e450af1f7f64b17442193cbac53f2a9f7e17", "message": "adding na.count option", "diff": "@@ -19,7 +19,7 @@\n #' @importFrom stats wilcox.test\n #' \n #' @export\n-ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F){\n+ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F, na.count=F){\n   data <- as.rdf(data)\n   t <- data.frame()\n   for (x in xs){", "原始编码": "GBK", "md5": "6175944785917da145a7e96adda4898b", "时间": "20210909", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "7533994e79ab1c7267e8088ee494982d25f52279..553b3e473dd254fc72f6107df5596495866245de", "message": "adding na.count option", "diff": "@@ -24,14 +24,33 @@ ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, c\n   t <- data.frame()\n   for (x in xs){\n     print(paste0(\"working on \", x))\n+    \n+    # generate segment\n     if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n     if (x %in% num){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2)))}\n     if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n     if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n     if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n+    \n+    # add count of missings\n+    if (na.count==T){\n+      groups <- unique(na.omit(data[[treat]]))\n+      groups <- groups[order(groups)]\n+      nas <- as.character()\n+      for (g in groups){\n+        nas <- c(nas, sum(is.na(data[[x]][data[[treat]]==g & !is.na(data[[treat]])])))\n+      } \n+      t$nas[nrow(t)] <- paste0(nas, collapse=\"/\")  \n+    } \n   }\n+  \n+  # formatting\n+  if (na.count==T){\n+    t <- cbind(t[,colnames(t)!=\"nas\"], t$nas)\n+    colnames(t)[colnames(t) %in% c(\"nas\", \"t$nas\")] <- paste0(\"NA's for \", paste0(groups, collapse=\"/\")) \n+  } \n   t <- t %>% dplyr::mutate_if(.predicate = is.ok.num, function(x) as.num(as.chr(x)))\n   t <- t %>% dplyr::mutate_if(.predicate = is.factor, function(x)       (as.chr(x)))\n   return(t)", "原始编码": "GBK", "md5": "b903cb0afa35fa0495278c832ae363cf", "时间": "20210909", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "9b1cb9e64ea9daa2793f50764e1870a5b017de7b..7533994e79ab1c7267e8088ee494982d25f52279", "message": "enabling descriptives when one group is NA only", "diff": "@@ -11,9 +11,13 @@\n twoway_num <- function(data, x, group, digit.m=1, digit.sd=1, cal.date=F){\n   d <- data[!is.na(data[[group]]),]\n   groups <- unique(na.omit(d[[group]]))\n+  \n+  # placeholder for groups\n   tab <- rep(NA, 2*length(groups)+2)\n   tab[1] <- x\n   tab[2] <- NA\n+  \n+  # get mean and SD \n   k <- 3\n   for (i in 1:length(groups)){\n     if (cal.date==F){tab[k+0] <- form.it(mean(d[[x]][d[[group]]==groups[i]], na.rm=T), digit.m)\n@@ -23,11 +27,12 @@ twoway_num <- function(data, x, group, digit.m=1, digit.sd=1, cal.date=F){\n     tab[k+1] <- form.it(  sd(d[[x]][d[[group]]==groups[i]], na.rm=T), digit.sd)\n     k <- k+2\n   }\n-  #tab[length(tab)+1] <- tryCatch({form.it(ordinal:::anova.clm(ordinal::clm(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\",), data=d, link=\"logit\"))$`Pr(>Chisq)`, 3)}, error=function(err) NA)\n+  \n+  # adding inferential test\n   if (length(groups)>2){\n     tab[length(tab)+1] <- tryCatch({form.it(pnorm(abs(coef(summary(MASS::polr(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\"), data=d)))[1,3]), lower.tail = F)*2, 3)}, error=function(err) NA)\n   } else {\n-    tab[length(tab)+1] <- form.it(wilcox.test(as.formula(paste0(\"as.numeric(\", x, \")~as.factor(\", group, \")\")), data=na.omit(d[,c(x, group)]))$p.value, 3)\n+    tab[length(tab)+1] <- tryCatch({form.it(wilcox.test(as.formula(paste0(\"as.numeric(\", x, \")~as.factor(\", group, \")\")), data=na.omit(d[,c(x, group)]))$p.value, 3)}, error=function(err) NA)\n   }\n   tab <- as.data.frame(t(tab))\n   colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")", "原始编码": "GBK", "md5": "5be8155be4e912116290267c92a47fa2", "时间": "20210903", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "de03766acf110843bf1f3c15198a32d33021f977..9b1cb9e64ea9daa2793f50764e1870a5b017de7b", "message": "mapping imports", "diff": "@@ -9,7 +9,6 @@\n #' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n #' \n #' @importFrom magrittr \"%>%\"\n-#' @importFrom magrittr %>%\n #' @importFrom stats as.formula\n #' @importFrom stats chisq.test\n #' @importFrom stats coef\n@@ -33,5 +32,7 @@ ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, c\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n   }\n+  t <- t %>% dplyr::mutate_if(.predicate = is.ok.num, function(x) as.num(as.chr(x)))\n+  t <- t %>% dplyr::mutate_if(.predicate = is.factor, function(x)       (as.chr(x)))\n   return(t)\n-}\n\\ No newline at end of file\n+}", "原始编码": "GBK", "md5": "f865c41f57194b2aa984428b5447aa62", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "9f6cfac73f7624a8442c7709e41f9ff552bf2b04..de03766acf110843bf1f3c15198a32d33021f977", "message": "mapping imports", "diff": "@@ -33,7 +33,5 @@ ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, c\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n   }\n-  t <- t %>% dplyr::mutate_if(is.ok.num, function(x) as.numeric(as.character(x)))\n-  t <- t %>% dplyr::mutate_if(is.factor, function(x) as.character(x))\n   return(t)\n }\n\\ No newline at end of file", "原始编码": "GBK", "md5": "ab2a8c781cd1a3a25a8a78e0ee4c0f13", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "bd996a11fd99bf801f49a0c89327ae4ce1cd3668..9f6cfac73f7624a8442c7709e41f9ff552bf2b04", "message": "mapping imports", "diff": "@@ -9,6 +9,7 @@\n #' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n #' \n #' @importFrom magrittr \"%>%\"\n+#' @importFrom magrittr %>%\n #' @importFrom stats as.formula\n #' @importFrom stats chisq.test\n #' @importFrom stats coef", "原始编码": "GBK", "md5": "b0b3bcf8ca26b51347d5c530f9ae0156", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "DESCRIPTION", "文件名": "DESCRIPTION", "ext": "", "index": "3ac430fbfb278ffda9a67cbbda165ea42eb95ee3..bd996a11fd99bf801f49a0c89327ae4ce1cd3668", "message": "mapping imports", "diff": "@@ -8,20 +8,19 @@ Authors@R:\n          email = \"anders@socioskop.dk\",\n          comment = c(ORCID = \"0000-0002-5321-6855\"))\n Description: tools for tabulation data from RCTs or case-control studies. Or really any data with 2+ groups as the main factor. \n-License: `bsd_3_clause`\n+License: MIT\n Encoding: UTF-8\n LazyData: true\n Roxygen: list(markdown = TRUE)\n RoxygenNote: 7.1.1\n Imports: \n   data.table, \n   dplyr, \n+  stats,\n   lubridate, \n   MASS, \n   magrittr, \n-  tibble\n-Depends: R (>= 2.10), data.table\n-NeedsCompilation: no\n-Author: Anders Bo Bojesen [aut, cre] (<https://orcid.org/0000-0002-5321-6855>)\n-Maintainer: Anders Bo Bojesen <anders@socioskop.dk>\n-  \n+  tibble,\n+  foreach,\n+  haven,\n+  stringr", "原始编码": "GBK", "md5": "2750845e7c644c05eab346a0e5662ec6", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "3ac430fbfb278ffda9a67cbbda165ea42eb95ee3..bd996a11fd99bf801f49a0c89327ae4ce1cd3668", "message": "mapping imports", "diff": "@@ -9,7 +9,16 @@ export(grab_dst)\n export(is.ok.date)\n export(is.ok.num)\n export(ttabulate)\n-export(twoway.n)\n export(twoway_chi)\n+export(twoway_n)\n export(twoway_num)\n+importFrom(foreach,\"%do%\")\n importFrom(magrittr,\"%>%\")\n+importFrom(stats,as.formula)\n+importFrom(stats,chisq.test)\n+importFrom(stats,coef)\n+importFrom(stats,ecdf)\n+importFrom(stats,na.omit)\n+importFrom(stats,pnorm)\n+importFrom(stats,sd)\n+importFrom(stats,wilcox.test)", "原始编码": "GBK", "md5": "8feedb9c334cff3e57d0f0da10329899", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/grab_dst.R", "文件名": "grab_dst.R", "ext": "R", "index": "3ac430fbfb278ffda9a67cbbda165ea42eb95ee3..bd996a11fd99bf801f49a0c89327ae4ce1cd3668", "message": "mapping imports", "diff": "@@ -7,6 +7,8 @@\n #' @param vars vector of variable names to be kept \n #' @param s.id name of the variable that contains the ids in source data\n #' @param show.vars logical to enable printing of variable names in source data.\n+#' \n+#' @importFrom foreach \"%do%\"\n #'  \n #' @export\n grab_dst <- function(path, reg, years, pop, vars=NULL, s.id=NULL, show.vars=F){\n@@ -19,7 +21,7 @@ grab_dst <- function(path, reg, years, pop, vars=NULL, s.id=NULL, show.vars=F){\n   files <- files[grepl(paste0(as.character(years), collapse=\"|\"), files)]\n   \n   # pull to list\n-  ff <- foreach(file = files) %do% {\n+  ff <- foreach::foreach(file = files) %do% {\n     f <- haven::read_sas(paste0(path, file))\n     colnames(f) <- tolower(colnames(f))\n     if (show.vars==T & file==files[1]){print(colnames(f))}", "原始编码": "GBK", "md5": "09fb73f839e85aaa954db94530cc2dcb", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "3ac430fbfb278ffda9a67cbbda165ea42eb95ee3..bd996a11fd99bf801f49a0c89327ae4ce1cd3668", "message": "mapping imports", "diff": "@@ -9,20 +9,28 @@\n #' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n #' \n #' @importFrom magrittr \"%>%\"\n+#' @importFrom stats as.formula\n+#' @importFrom stats chisq.test\n+#' @importFrom stats coef\n+#' @importFrom stats ecdf \n+#' @importFrom stats na.omit \n+#' @importFrom stats pnorm \n+#' @importFrom stats sd \n+#' @importFrom stats wilcox.test\n #' \n #' @export\n ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F){\n   data <- as.rdf(data)\n   t <- data.frame()\n   for (x in xs){\n     print(paste0(\"working on \", x))\n-    if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway.n  (data=data, x, treat)))}\n-    if (x %in% num){try(t <- dplyr::bind_rows(t, twoway.num(data=data, x, treat, digit.m = 2, digit.sd = 2)))}\n-    if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway.num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n-    if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n-    if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n-    if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n-    if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n+    if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway_n  (data=data, x, treat)))}\n+    if (x %in% num){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2)))}\n+    if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway_num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n+    if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n+    if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n+    if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n+    if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway_chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n   }\n   t <- t %>% dplyr::mutate_if(is.ok.num, function(x) as.numeric(as.character(x)))\n   t <- t %>% dplyr::mutate_if(is.factor, function(x) as.character(x))", "原始编码": "GBK", "md5": "d4aa2c308702190da139f64e2f864b2e", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_n.R", "文件名": "twoway_n.R", "ext": "R", "index": "3ac430fbfb278ffda9a67cbbda165ea42eb95ee3..bd996a11fd99bf801f49a0c89327ae4ce1cd3668", "message": "mapping imports", "diff": "@@ -5,7 +5,7 @@\n #' @param group the name of the variable which identifies groups/arms.\n #' \n #' @export\n-twoway.n <- function(data, x, group){\n+twoway_n <- function(data, x, group){\n   d <- data[!is.na(data[[group]]),]\n   tab <- table(d[[x]], d[[group]], useNA=\"ifany\")\n   groups <- colnames(tab)", "原始编码": "GBK", "md5": "6f86a6f6e264f7c5aa027abdfa6eb74b", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/twoway_n.Rd", "文件名": "twoway_n.Rd", "ext": "Rd", "index": "3ac430fbfb278ffda9a67cbbda165ea42eb95ee3..bd996a11fd99bf801f49a0c89327ae4ce1cd3668", "message": "mapping imports", "diff": "@@ -1,10 +1,10 @@\n % Generated by roxygen2: do not edit by hand\n % Please edit documentation in R/twoway_n.R\n-\\name{twoway.n}\n-\\alias{twoway.n}\n+\\name{twoway_n}\n+\\alias{twoway_n}\n \\title{twoway table of n indicator data}\n \\usage{\n-twoway.n(data, x, group)\n+twoway_n(data, x, group)\n }\n \\arguments{\n \\item{data}{data frame with the group identifier and n-counter}", "原始编码": "GBK", "md5": "3cd5c2c84e6e224ac2448be24ddfe3bd", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "c09c1b2678c6d8616b48d45ee0052174fe9d20ad..3ac430fbfb278ffda9a67cbbda165ea42eb95ee3", "message": "magrittr pipe import", "diff": "@@ -8,7 +8,7 @@\n #' @param bin character vector with names of those variables in xs that are to be summarized as binary variables\n #' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n #' \n-#' @importFrom magrittr %>%\n+#' @importFrom magrittr \"%>%\"\n #' \n #' @export\n ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F){", "原始编码": "GBK", "md5": "32e94dbd3ca18a1f77e52c236456e8d1", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "55591f93c4f70e121b3e6fb1d085fc16a13959a0..c09c1b2678c6d8616b48d45ee0052174fe9d20ad", "message": "magrittr pipe import", "diff": "@@ -12,4 +12,4 @@ export(ttabulate)\n export(twoway.n)\n export(twoway_chi)\n export(twoway_num)\n-importFrom(magrittr,`%>%`)\n+importFrom(magrittr,\"%>%\")", "原始编码": "GBK", "md5": "23495558b93494d24719f456030fa9f3", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "55591f93c4f70e121b3e6fb1d085fc16a13959a0..c09c1b2678c6d8616b48d45ee0052174fe9d20ad", "message": "magrittr pipe import", "diff": "@@ -8,7 +8,7 @@\n #' @param bin character vector with names of those variables in xs that are to be summarized as binary variables\n #' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n #' \n-#' @importFrom magrittr `%>%`\n+#' @importFrom magrittr %>%\n #' \n #' @export\n ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F){", "原始编码": "GBK", "md5": "70c5cc5a641dd15ea6985dda2f4d3e2c", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "380e2a52c81acbc0b28b323b1808868f7b6eb8bd..55591f93c4f70e121b3e6fb1d085fc16a13959a0", "message": "magrittr pipe import", "diff": "@@ -12,3 +12,4 @@ export(ttabulate)\n export(twoway.n)\n export(twoway_chi)\n export(twoway_num)\n+importFrom(magrittr,`%>%`)", "原始编码": "GBK", "md5": "32655b33be798d96c9ced79c87d888bc", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "cde1f24511551bbef8e813218d9af8f33a520692..380e2a52c81acbc0b28b323b1808868f7b6eb8bd", "message": "magrittr pipe import", "diff": "@@ -8,6 +8,8 @@\n #' @param bin character vector with names of those variables in xs that are to be summarized as binary variables\n #' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n #' \n+#' @importFrom magrittr `%>%`\n+#' \n #' @export\n ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F){\n   data <- as.rdf(data)", "原始编码": "GBK", "md5": "ac15883193fcf4c160fb93af86072ca6", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "NAMESPACE", "文件名": "NAMESPACE", "ext": "", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,14 @@\n+# Generated by roxygen2: do not edit by hand\n+\n+export(as.chr)\n+export(as.num)\n+export(as.rdf)\n+export(form.it)\n+export(get.q)\n+export(grab_dst)\n+export(is.ok.date)\n+export(is.ok.num)\n+export(ttabulate)\n+export(twoway.n)\n+export(twoway_chi)\n+export(twoway_num)", "原始编码": "GBK", "md5": "bc12c3914a6518b1c22ad07e3ba2ee2e", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/as.chr.Rd", "文件名": "as.chr.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,11 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{as.chr}\n+\\alias{as.chr}\n+\\title{short for conversion to character}\n+\\usage{\n+as.chr(x)\n+}\n+\\description{\n+short for conversion to character\n+}", "原始编码": "GBK", "md5": "f0309d235a60eb965150a433f1937671", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/as.num.Rd", "文件名": "as.num.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,11 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{as.num}\n+\\alias{as.num}\n+\\title{short for conversion to numeric}\n+\\usage{\n+as.num(x)\n+}\n+\\description{\n+short for conversion to numeric\n+}", "原始编码": "GBK", "md5": "09d170b669514cc42600a134747d04f7", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/as.rdf.Rd", "文件名": "as.rdf.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,11 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{as.rdf}\n+\\alias{as.rdf}\n+\\title{short for conversion to dataframe}\n+\\usage{\n+as.rdf(x)\n+}\n+\\description{\n+short for conversion to dataframe\n+}", "原始编码": "GBK", "md5": "8343a806b04241c7f4ed382c087eafb8", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/form.it.Rd", "文件名": "form.it.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,11 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{form.it}\n+\\alias{form.it}\n+\\title{formats a numeric vector to a fixed string format with digits}\n+\\usage{\n+form.it(x, digits = 3, perc = F, max = NULL)\n+}\n+\\description{\n+formats a numeric vector to a fixed string format with digits\n+}", "原始编码": "GBK", "md5": "b3da45b3c785e3cc89d26c013f42a82c", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/get.q.Rd", "文件名": "get.q.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,14 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{get.q}\n+\\alias{get.q}\n+\\title{get cumulative distribution func}\n+\\usage{\n+get.q(x)\n+}\n+\\value{\n+transforms a vector to its' quantiles\n+}\n+\\description{\n+get cumulative distribution func\n+}", "原始编码": "GBK", "md5": "88cf1876e15cd3726beb75d58574dbc7", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/grab_dst.Rd", "文件名": "grab_dst.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,26 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/grab_dst.R\n+\\name{grab_dst}\n+\\alias{grab_dst}\n+\\title{raw data pull for DST data}\n+\\usage{\n+grab_dst(path, reg, years, pop, vars = NULL, s.id = NULL, show.vars = F)\n+}\n+\\arguments{\n+\\item{path}{path to raw data dir}\n+\n+\\item{reg}{base name of registry (data file base word, when \\link{0-9} are removed)}\n+\n+\\item{years}{a vector of the years (e.g. 1991:2021) or other regular definitions of time periods covered by registries. For DREAM, this would be CCYYMM-CCYYMM.}\n+\n+\\item{pop}{a vector of identifiers, which the data extracted will be limited to}\n+\n+\\item{vars}{vector of variable names to be kept}\n+\n+\\item{s.id}{name of the variable that contains the ids in source data}\n+\n+\\item{show.vars}{logical to enable printing of variable names in source data.}\n+}\n+\\description{\n+raw data pull for DST data\n+}", "原始编码": "GBK", "md5": "377b27532c639d780412ff933849b852", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/is.ok.date.Rd", "文件名": "is.ok.date.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,11 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{is.ok.date}\n+\\alias{is.ok.date}\n+\\title{check date column}\n+\\usage{\n+is.ok.date(x)\n+}\n+\\description{\n+returning true is character column can be converted to date without any lost observations\n+}", "原始编码": "GBK", "md5": "344e516b44a320178503dbcccc0ba65d", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/is.ok.num.Rd", "文件名": "is.ok.num.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,14 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/formats.R\n+\\name{is.ok.num}\n+\\alias{is.ok.num}\n+\\title{a set of generic functions that speed up coding}\n+\\usage{\n+is.ok.num(x)\n+}\n+\\description{\n+check string data before converting to numeric\n+}\n+\\details{\n+returning true if character column can be converted to numeric without any losses\n+}", "原始编码": "GBK", "md5": "dbdf35ef148078d971977bbf4acf0cc6", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/ttabulate.Rd", "文件名": "ttabulate.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,35 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/ttabulate.R\n+\\name{ttabulate}\n+\\alias{ttabulate}\n+\\title{wraps up (align & stack) a set of twoway tables}\n+\\usage{\n+ttabulate(\n+  data,\n+  xs,\n+  treat,\n+  num = NA,\n+  cat = NA,\n+  bin = NA,\n+  dichotomize = NA,\n+  cal.date = NA,\n+  cens = 5,\n+  show.na = F\n+)\n+}\n+\\arguments{\n+\\item{data}{data frame}\n+\n+\\item{xs}{list of variables that should be summarized}\n+\n+\\item{treat}{character variable indicating treatment/comparison groups}\n+\n+\\item{num}{dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing}\n+\n+\\item{cat}{character vector with names of those variables in xs that are to be summarized as categorical variables}\n+\n+\\item{bin}{character vector with names of those variables in xs that are to be summarized as binary variables}\n+}\n+\\description{\n+wraps up (align & stack) a set of twoway tables\n+}", "原始编码": "GBK", "md5": "152aea79998ac9a659ff772ac16f559c", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/twoway.n.Rd", "文件名": "twoway.n.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,18 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/twoway_n.R\n+\\name{twoway.n}\n+\\alias{twoway.n}\n+\\title{twoway table of n indicator data}\n+\\usage{\n+twoway.n(data, x, group)\n+}\n+\\arguments{\n+\\item{data}{data frame with the group identifier and n-counter}\n+\n+\\item{x}{the n count, should be just a konstant k=1, unless data is aggregated}\n+\n+\\item{group}{the name of the variable which identifies groups/arms.}\n+}\n+\\description{\n+twoway table of n indicator data\n+}", "原始编码": "GBK", "md5": "e29e03d7f1c9576ac3e88de9cafb73de", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/twoway_chi.Rd", "文件名": "twoway_chi.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,27 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/twoway_chi.R\n+\\name{twoway_chi}\n+\\alias{twoway_chi}\n+\\title{twoway table of categorical data}\n+\\usage{\n+twoway_chi(data, x, group, bin = F, cens, force.two = F, show.na = F)\n+}\n+\\arguments{\n+\\item{data}{dataset containing group factor and the x-variable to be summed up}\n+\n+\\item{x}{variable to be summed}\n+\n+\\item{bin}{logical indicator to only use last row of two-way table (FALSE is default)}\n+\n+\\item{cens}{positive integer deciding the lower threshold for when to clear cells in order to hide very detailed patient-level data}\n+\n+\\item{force.two}{logical to use for counts where values >1 should be considered 1 (then effectively testing and showing a binary variable).}\n+\n+\\item{show.na}{logical to use missing data as an explicit category (default FALSE)}\n+}\n+\\value{\n+returns a data.frame. Has standardized column names, ready to stack with output from other grit::twoway* functions.\n+}\n+\\description{\n+twoway table of categorical data\n+}", "原始编码": "GBK", "md5": "cc6e64a9abcb42a45be8b7daf2da677b", "时间": "20210527", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "man/twoway_num.Rd", "文件名": "twoway_num.Rd", "ext": "Rd", "index": "9581b571b9c45b36da621e148f390f5f6c46e1b0..cde1f24511551bbef8e813218d9af8f33a520692", "message": "rebuild", "diff": "@@ -0,0 +1,24 @@\n+% Generated by roxygen2: do not edit by hand\n+% Please edit documentation in R/twoway_num.R\n+\\name{twoway_num}\n+\\alias{twoway_num}\n+\\title{twoway table of numeric data}\n+\\usage{\n+twoway_num(data, x, group, digit.m = 1, digit.sd = 1, cal.date = F)\n+}\n+\\arguments{\n+\\item{data}{data frame}\n+\n+\\item{x}{the numeric variable to be summarized}\n+\n+\\item{group}{the variable which identifies treatment/comparison groups}\n+\n+\\item{digit.m}{number of digits on mean estimates}\n+\n+\\item{digit.sd}{number of digits for estimates of the standard deviation}\n+\n+\\item{cal.date}{logical indicating that the x variable should be treated as a date. Will then show the mean value as an actual date.}\n+}\n+\\description{\n+twoway table of numeric data\n+}", "原始编码": "GBK", "md5": "b114119a252b07b07b2c6f3ae76215e2", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "4247b664f4bb1c3c4aa04b67dbdd77b290d4a4d1..9581b571b9c45b36da621e148f390f5f6c46e1b0", "message": "adding formatting tools", "diff": "@@ -22,7 +22,7 @@ ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, c\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n   }\n-  t <- t %>% dplyr::mutate_if(ttools::is.ok.num, function(x) as.numeric(as.character(x)))\n+  t <- t %>% dplyr::mutate_if(is.ok.num, function(x) as.numeric(as.character(x)))\n   t <- t %>% dplyr::mutate_if(is.factor, function(x) as.character(x))\n   return(t)\n }\n\\ No newline at end of file", "原始编码": "GBK", "md5": "bbd08fd0a7e1d2e7ed367f54a2092051", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "d5e365c3cdecbafae6d99d62592e9dde56823960..4247b664f4bb1c3c4aa04b67dbdd77b290d4a4d1", "message": "refactoring", "diff": "@@ -22,7 +22,7 @@ ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, c\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n   }\n-  t <- t %>% dplyr::mutate_if(is.ok.num, function(x) as.numeric(as.character(x)))\n+  t <- t %>% dplyr::mutate_if(ttools::is.ok.num, function(x) as.numeric(as.character(x)))\n   t <- t %>% dplyr::mutate_if(is.factor, function(x) as.character(x))\n   return(t)\n }\n\\ No newline at end of file", "原始编码": "GBK", "md5": "f033e057a87ef73b377f216084ffd180", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "de5254563695bacd5d379cdb906cbb5cc3556359..d5e365c3cdecbafae6d99d62592e9dde56823960", "message": "refactoring", "diff": "@@ -22,7 +22,7 @@ ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, c\n     if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n     if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n   }\n-  t <- t %>% dplyr::mutate_if(is.ok, function(x) as.numeric(as.character(x)))\n+  t <- t %>% dplyr::mutate_if(is.ok.num, function(x) as.numeric(as.character(x)))\n   t <- t %>% dplyr::mutate_if(is.factor, function(x) as.character(x))\n   return(t)\n }\n\\ No newline at end of file", "原始编码": "GBK", "md5": "721405a78bf07cb4d35f72103532664c", "时间": "20210527", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "DESCRIPTION", "文件名": "DESCRIPTION", "ext": "", "index": "cbf8f4852db53de6653eddeef367cf8479d98787..de5254563695bacd5d379cdb906cbb5cc3556359", "message": "fixed dependencies error", "diff": "@@ -1,5 +1,5 @@\n Package: ttools\n-Title: Function library to facilitate standard groupwise comparisons\n+Title: trial tabulation tools - Function library to facilitate standard groupwise comparisons\n Version: 0.1.1\n Authors@R: \n   person(given = \"Anders Bo\",\n@@ -13,7 +13,13 @@ Encoding: UTF-8\n LazyData: true\n Roxygen: list(markdown = TRUE)\n RoxygenNote: 7.1.1\n-Imports: data.table, dplyr, lubridate, MASS, magrittr, \n+Imports: \n+  data.table, \n+  dplyr, \n+  lubridate, \n+  MASS, \n+  magrittr, \n+  tibble\n Depends: R (>= 2.10), data.table\n NeedsCompilation: no\n Author: Anders Bo Bojesen [aut, cre] (<https://orcid.org/0000-0002-5321-6855>)", "原始编码": "GBK", "md5": "8c91f17424a1ed517678aa226ac4506f", "时间": "20210526", "扩展字段": "{}"}]
[]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "_DESCRIPTION", "文件名": "_DESCRIPTION", "ext": "", "index": "960934169499987a9f6b0b810967773d78368a99..0b59000367af2fecf8063457abfc471d5f89c3f7", "message": "Delete _DESCRIPTION", "diff": "@@ -1,13 +0,0 @@\n-Package: ttools\n-Type: Package\n-Title: trial tabulation tools\n-Version: 0.1.0\n-Author: c(person(given=\"Anders Bo\", \n-                 family=\"Bojesen\", \n-                 role=\"aut\",\n-                 email=\"anders@socioskop.dk\",\n-                 comment=c(ORCID=\"0000-0002-5321-6855\")))\n-Description: tools for tabulation data from RCTs or case-control studies. Or really any data with 2+ groups as the main factor. \n-License: `bsd_3_clause`\n-Encoding: UTF-8\n-LazyData: true", "原始编码": "GBK", "md5": "4ad6a20659bcf6fd20a5bb4475a44560", "时间": "20210526", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "README.md", "文件名": "README.md", "ext": "md", "index": "4d35c96f962340f9a9f8cc77b8ec52c67cbcc5b3..1b90947d10b366b65989cb33469b21d9cad32369", "message": "Merge branch 'main' of github.com:socioskop/ttools", "diff": "@@ -1 +1,6 @@\n-# ttools\n\\ No newline at end of file\n+# ttools\n+\n+functions to use in medical research, particularly randomized and controlled trials and case-control studies.\n+\n+Main set of functions facilitate tabulation of group-wise comparisons commonly used in medical research (case-controls, RCT designs, etc.).\n+", "原始编码": "GBK", "md5": "2a7abba2b1b002a79bbb52f971b9e80d", "时间": "20210526", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "_DESCRIPTION", "文件名": "_DESCRIPTION", "ext": "", "index": "4d35c96f962340f9a9f8cc77b8ec52c67cbcc5b3..1b90947d10b366b65989cb33469b21d9cad32369", "message": "Merge branch 'main' of github.com:socioskop/ttools", "diff": "@@ -1,13 +0,0 @@\n-Package: ttools\n-Type: Package\n-Title: trial tabulation tools\n-Version: 0.1.0\n-Author: c(person(given=\"Anders Bo\", \n-                 family=\"Bojesen\", \n-                 role=\"aut\",\n-                 email=\"anders@socioskop.dk\",\n-                 comment=c(ORCID=\"0000-0002-5321-6855\")))\n-Description: tools for tabulation data from RCTs or case-control studies. Or really any data with 2+ groups as the main factor. \n-License: `bsd_3_clause`\n-Encoding: UTF-8\n-LazyData: true", "原始编码": "GBK", "md5": "4ad6a20659bcf6fd20a5bb4475a44560", "时间": "20210526", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "README.md", "文件名": "README.md", "ext": "md", "index": "4d35c96f962340f9a9f8cc77b8ec52c67cbcc5b3..960934169499987a9f6b0b810967773d78368a99", "message": "Merge branch 'main' of github.com:socioskop/ttools", "diff": "@@ -1 +1,6 @@\n-# ttools\n\\ No newline at end of file\n+# ttools\n+\n+functions to use in medical research, particularly randomized and controlled trials and case-control studies.\n+\n+Main set of functions facilitate tabulation of group-wise comparisons commonly used in medical research (case-controls, RCT designs, etc.).\n+", "原始编码": "GBK", "md5": "2a7abba2b1b002a79bbb52f971b9e80d", "时间": "20210526", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "DESCRIPTION", "文件名": "DESCRIPTION", "ext": "", "index": "1d4c831cf6694a7852394cd37e6e051b0e6676bb..4d35c96f962340f9a9f8cc77b8ec52c67cbcc5b3", "message": "add formats", "diff": "@@ -1,13 +1,21 @@\n Package: ttools\n-Type: Package\n-Title: trial tabulation tools\n-Version: 0.1.0\n-Author: c(person(given=\"Anders Bo\", \n-                 family=\"Bojesen\", \n-                 role=\"aut\",\n-                 email=\"anders@socioskop.dk\",\n-                 comment=c(ORCID=\"0000-0002-5321-6855\")))\n+Title: Function library to facilitate standard groupwise comparisons\n+Version: 0.1.1\n+Authors@R: \n+  person(given = \"Anders Bo\",\n+         family = \"Bojesen\",\n+         role = c(\"aut\", \"cre\"),\n+         email = \"anders@socioskop.dk\",\n+         comment = c(ORCID = \"0000-0002-5321-6855\"))\n Description: tools for tabulation data from RCTs or case-control studies. Or really any data with 2+ groups as the main factor. \n-License: MIT\n+License: `bsd_3_clause`\n Encoding: UTF-8\n LazyData: true\n+Roxygen: list(markdown = TRUE)\n+RoxygenNote: 7.1.1\n+Imports: data.table, dplyr, lubridate, MASS, magrittr, \n+Depends: R (>= 2.10), data.table\n+NeedsCompilation: no\n+Author: Anders Bo Bojesen [aut, cre] (<https://orcid.org/0000-0002-5321-6855>)\n+Maintainer: Anders Bo Bojesen <anders@socioskop.dk>\n+  ", "原始编码": "GBK", "md5": "7a704093b0d4162ba2fa3ce3ec83ae3a", "时间": "20210526", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/formats.R", "文件名": "formats.R", "ext": "R", "index": "1d4c831cf6694a7852394cd37e6e051b0e6676bb..4d35c96f962340f9a9f8cc77b8ec52c67cbcc5b3", "message": "add formats", "diff": "@@ -0,0 +1,54 @@\n+#' a set of generic functions that speed up coding \n+#' \n+#' check string data before converting to numeric\n+#'\n+#' returning true if character column can be converted to numeric without any losses\n+#' @export\n+is.ok.num <- function(x){\n+  (sum(!is.na(x))==sum(!is.na(as.numeric(as.character(x)))) & length(x[grepl(paste0(c(letters, \"\\\\-\"), collapse=\"|\"), x)])==0)\n+}\n+\n+#' check date column\n+#'\n+#' returning true is character column can be converted to date without any lost observations\n+#' @export\n+is.ok.date <- function(x){\n+  x <- x[!is.nan(x)]\n+  (sum(!is.na(x))==sum(!is.na(lubridate::as_date(x))))\n+}\n+\n+#' short for conversion to character\n+#'\n+#' @export\n+as.chr <- function(x){as.character(x)}\n+is.chr <- function(x){is.character(x)}\n+\n+#' short for conversion to numeric\n+#'\n+#' @export\n+as.num <- function(x){as.numeric(x)}\n+is.num <- function(x){is.numeric(x)}\n+\n+#' short for conversion to dataframe\n+#'\n+#' @export\n+as.rdf <- function(x){as.data.frame(x)}\n+\n+#' formats a numeric vector to a fixed string format with digits\n+#' @export\n+form.it <- function(x, digits=3, perc=F, max=NULL){\n+  if (!is.null(max)){\n+    x[x>max] <- Inf\n+  }\n+  x <- format(round(x, digits), nsmall=digits)\n+  if (perc==T){x <- paste0(x, \"%\")}\n+  return(x)\n+}\n+\n+#' get cumulative distribution func\n+#' @return transforms a vector to its' quantiles\n+#' @export\n+get.q <- function(x){\n+  efunc <- ecdf(x)\n+  return(efunc(x))\n+}", "原始编码": "GBK", "md5": "52ea8c285f55158f35eda3b9be16da14", "时间": "20210526", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "_DESCRIPTION", "文件名": "_DESCRIPTION", "ext": "", "index": "1d4c831cf6694a7852394cd37e6e051b0e6676bb..4d35c96f962340f9a9f8cc77b8ec52c67cbcc5b3", "message": "add formats", "diff": "@@ -0,0 +1,13 @@\n+Package: ttools\n+Type: Package\n+Title: trial tabulation tools\n+Version: 0.1.0\n+Author: c(person(given=\"Anders Bo\", \n+                 family=\"Bojesen\", \n+                 role=\"aut\",\n+                 email=\"anders@socioskop.dk\",\n+                 comment=c(ORCID=\"0000-0002-5321-6855\")))\n+Description: tools for tabulation data from RCTs or case-control studies. Or really any data with 2+ groups as the main factor. \n+License: `bsd_3_clause`\n+Encoding: UTF-8\n+LazyData: true", "原始编码": "GBK", "md5": "25e990537f5af60cbdae9ce22be78e6c", "时间": "20210526", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "README.md", "文件名": "README.md", "ext": "md", "index": "1d4c831cf6694a7852394cd37e6e051b0e6676bb..28efac3361267bfbda8548932c789e3b1d78c1b8", "message": "updated readme", "diff": "@@ -1 +1,6 @@\n-# ttools\n\\ No newline at end of file\n+# ttools\n+\n+functions to use in medical research, particularly randomized and controlled trials and case-control studies.\n+\n+Main set of functions facilitate tabulation of group-wise comparisons commonly used in medical research (case-controls, RCT designs, etc.).\n+", "原始编码": "GBK", "md5": "2a7abba2b1b002a79bbb52f971b9e80d", "时间": "20210525", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/grab_dst.R", "文件名": "grab_dst.R", "ext": "R", "index": "d1077163040009a6b3e7a49d8eec123495662c5c..1d4c831cf6694a7852394cd37e6e051b0e6676bb", "message": "added comments", "diff": "@@ -1,7 +1,13 @@\n #' raw data pull for DST data\n #' \n #' @param path path to raw data dir\n-#' \n+#' @param reg base name of registry (data file base word, when [0-9] are removed)\n+#' @param years a vector of the years (e.g. 1991:2021) or other regular definitions of time periods covered by registries. For DREAM, this would be CCYYMM-CCYYMM.\n+#' @param pop a vector of identifiers, which the data extracted will be limited to\n+#' @param vars vector of variable names to be kept \n+#' @param s.id name of the variable that contains the ids in source data\n+#' @param show.vars logical to enable printing of variable names in source data.\n+#'  \n #' @export\n grab_dst <- function(path, reg, years, pop, vars=NULL, s.id=NULL, show.vars=F){\n   # reformat args", "原始编码": "GBK", "md5": "0782f8330e28cf9ee0473bcfb7579a38", "时间": "20210525", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/ttabulate.R", "文件名": "ttabulate.R", "ext": "R", "index": "d1077163040009a6b3e7a49d8eec123495662c5c..1d4c831cf6694a7852394cd37e6e051b0e6676bb", "message": "added comments", "diff": "@@ -0,0 +1,28 @@\n+#' wraps up (align & stack) a set of twoway tables\n+#' \n+#' @param data data frame\n+#' @param xs list of variables that should be summarized\n+#' @param treat character variable indicating treatment/comparison groups\n+#' @param num character vector with names of those variables in xs that are to be summarized as numeric variables\n+#' @param cat character vector with names of those variables in xs that are to be summarized as categorical variables\n+#' @param bin character vector with names of those variables in xs that are to be summarized as binary variables\n+#' @param num dichotomize vector with names of those categorical variables in xs that should be dichotomized before summarizing \n+#' \n+#' @export\n+ttabulate <- function(data, xs, treat, num=NA, cat=NA, bin=NA, dichotomize=NA, cal.date=NA, cens=5, show.na=F){\n+  data <- as.rdf(data)\n+  t <- data.frame()\n+  for (x in xs){\n+    print(paste0(\"working on \", x))\n+    if (x %in% \"n\"){try(t <- dplyr::bind_rows(t, twoway.n  (data=data, x, treat)))}\n+    if (x %in% num){try(t <- dplyr::bind_rows(t, twoway.num(data=data, x, treat, digit.m = 2, digit.sd = 2)))}\n+    if (x %in% cal.date){try(t <- dplyr::bind_rows(t, twoway.num(data=data, x, treat, digit.m = 2, digit.sd = 2, cal.date==T)))}\n+    if (x %in% cat){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, show.na=show.na)))}\n+    if (x %in% dichotomize & !x %in% bin){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, show.na=show.na)))}\n+    if (x %in% bin &         !x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, bin=T, show.na=show.na)))}\n+    if (x %in% bin &          x %in% dichotomize){try(t <- dplyr::bind_rows(t, twoway.chi(data=data, x, treat, cens=cens, force.two=T, bin=T, show.na=show.na)))}\n+  }\n+  t <- t %>% dplyr::mutate_if(is.ok, function(x) as.numeric(as.character(x)))\n+  t <- t %>% dplyr::mutate_if(is.factor, function(x) as.character(x))\n+  return(t)\n+}\n\\ No newline at end of file", "原始编码": "GBK", "md5": "78ced305ee76a6b4f2aa0bab8195782e", "时间": "20210525", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_n.R", "文件名": "twoway_n.R", "ext": "R", "index": "d1077163040009a6b3e7a49d8eec123495662c5c..1d4c831cf6694a7852394cd37e6e051b0e6676bb", "message": "added comments", "diff": "@@ -1,11 +1,11 @@\n-#' twoway table of n indicator data for groupwide comparison\n+#' twoway table of n indicator data\n #' \n-#' @param data a dataframe with a group variable and a count of individuals (e.g. n=1).\n-#' @param x the n-count variable, likely equal to 1 for any row included\n-#' @param group a character variable with categories corresponding to the groups being compared\n+#' @param data data frame with the group identifier and n-counter\n+#' @param x the n count, should be just a konstant k=1, unless data is aggregated\n+#' @param group the name of the variable which identifies groups/arms.\n #' \n #' @export\n-twoway_n <- function(data, x, group){\n+twoway.n <- function(data, x, group){\n   d <- data[!is.na(data[[group]]),]\n   tab <- table(d[[x]], d[[group]], useNA=\"ifany\")\n   groups <- colnames(tab)\n@@ -15,4 +15,4 @@ twoway_n <- function(data, x, group){\n   tab <- as.data.frame(t(tab))\n   colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")\n   return(tab)\n-}\n+}\n\\ No newline at end of file", "原始编码": "GBK", "md5": "77d48f537a1c112b6ce25ac6eb221505", "时间": "20210525", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_num.R", "文件名": "twoway_num.R", "ext": "R", "index": "d1077163040009a6b3e7a49d8eec123495662c5c..1d4c831cf6694a7852394cd37e6e051b0e6676bb", "message": "added comments", "diff": "@@ -0,0 +1,35 @@\n+#' twoway table of numeric data\n+#' \n+#' @param data data frame\n+#' @param x the numeric variable to be summarized\n+#' @param group the variable which identifies treatment/comparison groups \n+#' @param digit.m number of digits on mean estimates\n+#' @param digit.sd number of digits for estimates of the standard deviation\n+#' @param cal.date logical indicating that the x variable should be treated as a date. Will then show the mean value as an actual date.\n+#' \n+#' @export \n+twoway_num <- function(data, x, group, digit.m=1, digit.sd=1, cal.date=F){\n+  d <- data[!is.na(data[[group]]),]\n+  groups <- unique(na.omit(d[[group]]))\n+  tab <- rep(NA, 2*length(groups)+2)\n+  tab[1] <- x\n+  tab[2] <- NA\n+  k <- 3\n+  for (i in 1:length(groups)){\n+    if (cal.date==F){tab[k+0] <- form.it(mean(d[[x]][d[[group]]==groups[i]], na.rm=T), digit.m)\n+    } else {\n+      tab[k+0] <- as.character(lubridate::as_date(round(mean(d[[x]][d[[group]]==groups[i]], na.rm=T))))\n+    }\n+    tab[k+1] <- form.it(  sd(d[[x]][d[[group]]==groups[i]], na.rm=T), digit.sd)\n+    k <- k+2\n+  }\n+  #tab[length(tab)+1] <- tryCatch({form.it(ordinal:::anova.clm(ordinal::clm(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\",), data=d, link=\"logit\"))$`Pr(>Chisq)`, 3)}, error=function(err) NA)\n+  if (length(groups)>2){\n+    tab[length(tab)+1] <- tryCatch({form.it(pnorm(abs(coef(summary(MASS::polr(paste0(\"as.factor(\", x, \")~as.factor(\", group, \")\"), data=d)))[1,3]), lower.tail = F)*2, 3)}, error=function(err) NA)\n+  } else {\n+    tab[length(tab)+1] <- form.it(wilcox.test(as.formula(paste0(\"as.numeric(\", x, \")~as.factor(\", group, \")\")), data=na.omit(d[,c(x, group)]))$p.value, 3)\n+  }\n+  tab <- as.data.frame(t(tab))\n+  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")\n+  return(tab)\n+}", "原始编码": "GBK", "md5": "0e99e72aa51fa845373b3633c82d4c28", "时间": "20210525", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": ".Rbuildignore", "文件名": ".Rbuildignore", "ext": "Rbuildignore", "index": "1c8e36579c5d572a088b49f7bc7701a21e57631b..d1077163040009a6b3e7a49d8eec123495662c5c", "message": "added functions", "diff": "@@ -0,0 +1,2 @@\n+^.*\\.Rproj$\n+^\\.Rproj\\.user$", "原始编码": "GBK", "md5": "1f1d46b94bfff41b2c9bfb710ecbda81", "时间": "20210521", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_chi.R", "文件名": "twoway_chi.R", "ext": "R", "index": "1c8e36579c5d572a088b49f7bc7701a21e57631b..d1077163040009a6b3e7a49d8eec123495662c5c", "message": "added functions", "diff": "@@ -0,0 +1,61 @@\n+#' twoway table of categorical data\n+#' \n+#' @param data dataset containing group factor and the x-variable to be summed up\n+#' @param x variable to be summed\n+#' @param bin logical indicator to only use last row of two-way table (FALSE is default)\n+#' @param cens positive integer deciding the lower threshold for when to clear cells in order to hide very detailed patient-level data\n+#' @param force.two logical to use for counts where values >1 should be considered 1 (then effectively testing and showing a binary variable).\n+#' @param show.na logical to use missing data as an explicit category (default FALSE)\n+#' @return returns a data.frame. Has standardized column names, ready to stack with output from other grit::twoway* functions.\n+#' \n+#' @export\n+twoway_chi <- function(data, x, group, bin=F, cens, force.two=F, show.na=F) {\n+  # get data\n+  d <- data[!is.na(data[[group]]),]\n+  \n+  if (force.two==T){\n+    d[[x]] <- as.numeric(d[[x]]>=1)\n+  }\n+  \n+  if (is.null(cens)){cens <- -Inf}\n+  \n+  # generate table, p.value and labels\n+  tab <- table(as.character(d[[x]]), d[[group]], useNA=\"ifany\")\n+  \n+  groups <- colnames(tab)\n+  if (nrow(tab)<2){stop(\"too few levels\")}\n+  p <- form.it(chisq.test(tab)$p.value, 3)\n+  levels <- rownames(tab)\n+  \n+  # handle missings explicitly\n+  if (show.na==T){\n+    if (is.na(levels[length(levels)]) & sum(is.na(levels))==1) {levels[length(levels)] <- \"N/A\"}\n+  }\n+  \n+  # combine n and %\n+  tab <- matrix(rbind(tab, form.it(prop.table(tab, 2)*100, 1)), nrow=nrow(tab))\n+  \n+  # \n+  if (sum(as.num(tab[,1])<=cens & as.num(tab[,1])>0)>=1 | sum(as.num(tab[,3])<=cens & as.numeric(tab[,3])>0)>=1){\n+    p <- paste0(\"n<\", cens)\n+  }\n+  \n+  # add p value\n+  if (nrow(tab)>=2) {filling <- c(rep(NA, nrow(tab)-1), p)} else {filling <- p}\n+  if (nrow(tab)>=2 & bin==F){varname <- c(x, rep(NA, nrow(tab)-1))} else {varname <- rep(x, nrow(tab))}\n+  \n+  for (i in 1:nrow(tab)){\n+    tab[i,2][as.numeric(tab[i,1])<=cens] <- paste0(\"n<\", cens)\n+    tab[i,4][as.numeric(tab[i,3])<=cens] <- paste0(\"n<\", cens)\n+    tab[i,1][as.numeric(tab[i,1])<=cens] <- paste0(\"n<\", cens)\n+    tab[i,3][as.numeric(tab[i,3])<=cens] <- paste0(\"n<\", cens)\n+  }\n+  \n+  # wrap up, force regular colnames\n+  tab  <- as.data.frame(cbind(varname, levels, tab, filling))\n+  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")\n+  \n+  # pick last row if bin\n+  if (bin==T){tab <- tab[nrow(tab),]}\n+  return(tab)\n+}\n\\ No newline at end of file", "原始编码": "GBK", "md5": "ce167e9174198f8c13469ee3d11118aa", "时间": "20210521", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "R/twoway_n.R", "文件名": "twoway_n.R", "ext": "R", "index": "1c8e36579c5d572a088b49f7bc7701a21e57631b..d1077163040009a6b3e7a49d8eec123495662c5c", "message": "added functions", "diff": "@@ -0,0 +1,18 @@\n+#' twoway table of n indicator data for groupwide comparison\n+#' \n+#' @param data a dataframe with a group variable and a count of individuals (e.g. n=1).\n+#' @param x the n-count variable, likely equal to 1 for any row included\n+#' @param group a character variable with categories corresponding to the groups being compared\n+#' \n+#' @export\n+twoway_n <- function(data, x, group){\n+  d <- data[!is.na(data[[group]]),]\n+  tab <- table(d[[x]], d[[group]], useNA=\"ifany\")\n+  groups <- colnames(tab)\n+  if (nrow(tab)>1){stop(\"too many levels for n-count\")}\n+  tab <- c(rbind(tab, form.it(prop.table(tab, 2)*100, 1)))\n+  tab <- c(x, NA, tab, NA)\n+  tab <- as.data.frame(t(tab))\n+  colnames(tab) <- c(\"var\", \"level\", rbind(paste0(groups, \".mean/n\"), paste0(groups, \".sd/%\")), \"p.val\")\n+  return(tab)\n+}", "原始编码": "GBK", "md5": "32d8bccc973e20e2f780b3fa1351f5ef", "时间": "20210521", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "ttools.Rproj", "文件名": "ttools.Rproj", "ext": "Rproj", "index": "1c8e36579c5d572a088b49f7bc7701a21e57631b..d1077163040009a6b3e7a49d8eec123495662c5c", "message": "added functions", "diff": "@@ -11,3 +11,7 @@ Encoding: ISO8859-1\n \n RnwWeave: Sweave\n LaTeX: XeLaTeX\n+\n+BuildType: Package\n+PackageUseDevtools: Yes\n+PackageInstallArgs: --no-multiarch --with-keep.source", "原始编码": "GBK", "md5": "1cffd38ade911d49482eb4f759dbbee4", "时间": "20210521", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "DESCRIPTION", "文件名": "DESCRIPTION", "ext": "", "index": "ed6ebf729a9aad91f3daeef26e8e1e1f8377a594..1c8e36579c5d572a088b49f7bc7701a21e57631b", "message": "desc", "diff": "@@ -0,0 +1,13 @@\n+Package: ttools\n+Type: Package\n+Title: trial tabulation tools\n+Version: 0.1.0\n+Author: c(person(given=\"Anders Bo\", \n+                 family=\"Bojesen\", \n+                 role=\"aut\",\n+                 email=\"anders@socioskop.dk\",\n+                 comment=c(ORCID=\"0000-0002-5321-6855\")))\n+Description: tools for tabulation data from RCTs or case-control studies. Or really any data with 2+ groups as the main factor. \n+License: MIT\n+Encoding: UTF-8\n+LazyData: true", "原始编码": "GBK", "md5": "690a412c25059e12b79709b61219d55c", "时间": "20210521", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "README.md", "文件名": "README.md", "ext": "md", "index": "d75ee94c78b743dc366ab412fce9c9bce38456eb..ed6ebf729a9aad91f3daeef26e8e1e1f8377a594", "message": "Merge branch 'main' of github.com:socioskop/ttools", "diff": "@@ -0,0 +1 @@\n+# ttools\n\\ No newline at end of file", "原始编码": "GBK", "md5": "ef69a3979b704d2278cd4875884fce32", "时间": "20210521", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "README.md", "文件名": "README.md", "ext": "md", "index": "d131d2152ed34a647001cc80557309dd754305fe", "message": "Initial commit", "diff": "@@ -0,0 +1 @@\n+# ttools\n\\ No newline at end of file", "原始编码": "GBK", "md5": "ef69a3979b704d2278cd4875884fce32", "时间": "20210521", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": "R/grab_dst.R", "文件名": "grab_dst.R", "ext": "R", "index": "a8fb49324d2bd85843758ffed0b6d5e04daf3b29..d75ee94c78b743dc366ab412fce9c9bce38456eb", "message": "initial commit", "diff": "@@ -0,0 +1,27 @@\n+#' raw data pull for DST data\n+#' \n+#' @param path path to raw data dir\n+#' \n+#' @export\n+grab_dst <- function(path, reg, years, pop, vars=NULL, s.id=NULL, show.vars=F){\n+  # reformat args\n+  if (substr(path, nchar(path), nchar(path))!=\"/\"){path <- paste0(path, \"/\")}\n+  if (is.null(s.id)){s.id <- \"pnr\"}\n+  \n+  # get file list\n+  files <- list.files(path, pattern=reg)\n+  files <- files[grepl(paste0(as.character(years), collapse=\"|\"), files)]\n+  \n+  # pull to list\n+  ff <- foreach(file = files) %do% {\n+    f <- haven::read_sas(paste0(path, file))\n+    colnames(f) <- tolower(colnames(f))\n+    if (show.vars==T & file==files[1]){print(colnames(f))}\n+    f$year <- paste0(stringr::str_extract_all(file, \"[0-9]\")[[1]][1:4], collapse=\"\")\n+    f <- f[f[[s.id]] %in% pop,]\n+    if (!is.null(vars)){f <- f[,vars]}\n+    f\n+  }\n+  f <- dplyr::bind_rows(ff)\n+  return(f)\n+}\n\\ No newline at end of file", "原始编码": "GBK", "md5": "d4dc58c8eb75fd1de0e30642dd3b255d", "时间": "20210521", "扩展字段": "{}"}]
[{"来源": "github", "仓库名": "socioskop/ttools", "path": ".gitignore", "文件名": ".gitignore", "ext": "gitignore", "index": "a8fb49324d2bd85843758ffed0b6d5e04daf3b29", "message": "initial commit", "diff": "@@ -0,0 +1,4 @@\n+.Rproj.user\n+.Rhistory\n+.RData\n+.Ruserdata", "原始编码": "GBK", "md5": "f5be69e2cdc4469386f50a2ee70426a0", "时间": "20210521", "扩展字段": "{}"}, {"来源": "github", "仓库名": "socioskop/ttools", "path": "ttools.Rproj", "文件名": "ttools.Rproj", "ext": "Rproj", "index": "a8fb49324d2bd85843758ffed0b6d5e04daf3b29", "message": "initial commit", "diff": "@@ -0,0 +1,13 @@\n+Version: 1.0\n+\n+RestoreWorkspace: Default\n+SaveWorkspace: Default\n+AlwaysSaveHistory: Default\n+\n+EnableCodeIndexing: Yes\n+UseSpacesForTab: Yes\n+NumSpacesForTab: 2\n+Encoding: ISO8859-1\n+\n+RnwWeave: Sweave\n+LaTeX: XeLaTeX", "原始编码": "GBK", "md5": "99f10f5c745a08f101fbe3c1917a67b8", "时间": "20210521", "扩展字段": "{}"}]
